# Complex Type Insert Tests

# Setup test tables
statement ok
CREATE TABLE complex_types (
    id INTEGER,
    metadata STRUCT,
    tags VECTOR,
    data STRUCT,
    history VECTOR,
    updated_at TIMESTAMP
);

# Test basic insert with complex types
statement ok
INSERT INTO complex_types (id, metadata, tags, data, history, updated_at)
VALUES (1, STRUCT('{"name": "test", "value": 42}'), VECTOR[1, 2, 3], STRUCT('{"key": "value"}'), VECTOR['a', 'b'], 1000);

# Verify complex insert
query ITIT
SELECT * FROM complex_types ORDER BY id;
----
1 {"name": "test", "value": 42} [1, 2, 3] {"key": "value"} ['a', 'b'] 1000

# Test multiple row insert with complex types
statement ok
INSERT INTO complex_types (id, metadata, tags, data, history, updated_at) VALUES 
    (2, STRUCT('{"name": "test2", "value": 43}'), VECTOR[4, 5, 6], STRUCT('{"key": "value2"}'), VECTOR['c', 'd'], 2000),
    (3, STRUCT('{"name": "test3", "value": 44}'), VECTOR[7, 8, 9], STRUCT('{"key": "value3"}'), VECTOR['e', 'f'], 3000);

# Verify multiple complex inserts
query ITIT
SELECT * FROM complex_types ORDER BY id;
----
1 {"name": "test", "value": 42} [1, 2, 3] {"key": "value"} ['a', 'b'] 1000
2 {"name": "test2", "value": 43} [4, 5, 6] {"key": "value2"} ['c', 'd'] 2000
3 {"name": "test3", "value": 44} [7, 8, 9] {"key": "value3"} ['e', 'f'] 3000

# Test insert with NULL complex values
statement ok
INSERT INTO complex_types (id, metadata, tags, data, history, updated_at)
VALUES (4, NULL, NULL, NULL, NULL, NULL);

# Test insert with partial complex columns
statement ok
INSERT INTO complex_types (id, metadata, tags)
VALUES (5, STRUCT('{"name": "test5"}'), VECTOR[10, 11]);

# Test nested complex types
statement ok
CREATE TABLE nested_complex (
    id INTEGER,
    user_data STRUCT,
    preferences VECTOR,
    settings STRUCT
);

# Test insert with nested complex types
statement ok
INSERT INTO nested_complex (id, user_data, preferences, settings)
VALUES (1, 
    STRUCT('{"name": "user1", "data": {"age": 25, "city": "NY"}}'),
    VECTOR[1, 2, 3],
    STRUCT('{"theme": "dark", "notifications": true}')
);

# Verify nested complex insert
query ITIT
SELECT * FROM nested_complex ORDER BY id;
----
1 {"name": "user1", "data": {"age": 25, "city": "NY"}} [1, 2, 3] {"theme": "dark", "notifications": true}

# Error Cases

# Test inserting invalid complex type
statement error
INSERT INTO complex_types (id, metadata, tags)
VALUES (6, 'invalid_struct', 'invalid_vector');

# Test inserting with wrong number of complex columns
statement error
INSERT INTO complex_types (id, metadata, tags) VALUES (7, STRUCT('{"test": 1}'));

# Test inserting into non-existent complex table
statement error
INSERT INTO nonexistent_complex (id, data) VALUES (1, STRUCT('{"test": 1}')); 